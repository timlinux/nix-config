{config, ...}: let
  browser = "re.sonny.Junction.desktop";
  # spreadsheet = "libreoffice-calc.desktop";
  evince = "org.gnome.Evince.desktop";
  qgis = "org.qgis.qgis.desktop";
  image_viewer = "org.gnome.Loupe.desktop";
  video_viewer = "org.gnome.celluloid.desktop";
  calendar = "google-calendar.desktop";
  mail = "google-mail.desktop";
  logseq = "logseq.desktop;Logseq.desktop";
  editor = "org.gnome.TextEditor.desktop";
  slack = "slack.desktop";
  matrix = "io.element.element.desktop";
  vscode = "code.desktop"; # VS Code desktop entry
in {
  config = {
    xdg = {
      enable = true;
      # See https://github.com/nix-community/home-manager/issues/1213
      configFile."mimeapps.list".force = true;
      userDirs = {
        createDirectories = true;
        enable = true;
        documents = "${config.home.homeDirectory}/Documents";
        download = "${config.home.homeDirectory}/Downloads";
        music = "${config.home.homeDirectory}/Music";
        pictures = "${config.home.homeDirectory}/Pictures";
        videos = "${config.home.homeDirectory}/Videos";
        desktop = "${config.home.homeDirectory}/Desktop";
        templates = "${config.home.homeDirectory}/Templates";
      };

      mimeApps = {
        enable = true;
        associations.added = {
          "application/pdf" = [evince];
          "application/x-ipynb+json" = [vscode]; # Jupyter Notebook MIME type
        };
        defaultApplications = {
          "x-scheme-handler/webcals" = [mail];
          "x-scheme-handler/webcal" = [calendar];
          "x-scheme-handler/unknown" = [browser];
          "x-scheme-handler/tg" = [mail];
          "x-scheme-handler/slack" = [slack];
          "x-scheme-handler/mid" = [mail];
          "x-scheme-handler/mailto" = [mail];
          "x-scheme-handler/logseq" = [logseq];
          "x-scheme-handler/https" = [browser];
          "x-scheme-handler/http" = [browser];
          "x-scheme-handler/gitkraken" = ["GitKraken.desktop"];
          "x-scheme-handler/element" = [matrix];
          "x-scheme-handler/chrome" = [browser];
          "x-scheme-handler/about" = [browser];
          "video/x-theora+ogg" = [video_viewer];
          "video/x-theora" = [video_viewer];
          "video/x-ogm+ogg" = [video_viewer];
          "video/x-ogm" = [video_viewer];
          "video/x-nsv" = [video_viewer];
          "video/x-msvideo" = [video_viewer];
          "video/x-ms-wvx" = [video_viewer];
          "video/x-ms-wmx" = [video_viewer];
          "video/x-ms-wmv" = [video_viewer];
          "video/x-ms-wm" = [video_viewer];
          "video/x-ms-asx" = [video_viewer];
          "video/x-ms-asf" = [video_viewer];
          "video/x-ms-asf-plugin" = [video_viewer];
          "video/x-mpeg2" = [video_viewer];
          "video/x-mpeg" = [video_viewer];
          "video/x-mpeg-system" = [video_viewer];
          "video/x-matroska" = [video_viewer];
          "video/x-m4v" = [video_viewer];
          "video/x-flv" = [video_viewer];
          "video/x-fli" = [video_viewer];
          "video/x-flc" = [video_viewer];
          "video/x-avi" = [video_viewer];
          "video/x-anim" = [video_viewer];
          "video/webm" = [video_viewer];
          "video/vnd.rn-realvideo" = [video_viewer];
          "video/vnd.mpegurl" = [video_viewer];
          "video/vnd.divx" = [video_viewer];
          "video/quicktime" = [video_viewer];
          "video/ogg" = [video_viewer];
          "video/msvideo" = [video_viewer];
          "video/mpeg" = [video_viewer];
          "video/mpeg-system" = [video_viewer];
          "video/mp4v-es" = [video_viewer];
          "video/mp4" = [video_viewer];
          "video/mp2t" = [video_viewer];
          "video/flv" = [video_viewer];
          "video/fli" = [video_viewer];
          "video/dv" = [video_viewer];
          "video/divx" = [video_viewer];
          "video/avi" = [video_viewer];
          "video/3gpp2" = [video_viewer];
          "video/3gpp" = [video_viewer];
          "video/3gp" = [video_viewer];
          "text/plain" = [editor];
          "text/html" = [browser];
          "text/calendar" = [mail];
          "message/rfc822" = [mail];
          "image/x-xpixmap" = [image_viewer];
          "image/x-portable-pixmap" = [image_viewer];
          "image/x-portable-graymap" = [image_viewer];
          "image/x-portable-bitmap" = [image_viewer];
          "image/x-portable-anymap" = [image_viewer];
          "image/x-png" = [image_viewer];
          "image/x-pcx" = [image_viewer];
          "image/x-ico" = [image_viewer];
          "image/x-icns" = [image_viewer];
          "image/x-icb" = [image_viewer];
          "image/x-gray" = [image_viewer];
          "image/x-bmp" = [image_viewer];
          "image/webp" = [image_viewer];
          "image/vnd.wap.wbmp" = [image_viewer];
          "image/tiff" = [qgis image_viewer];
          "image/svg+xml" = [image_viewer];
          "image/svg+xml-compressed" = [image_viewer];
          "image/png" = [image_viewer];
          "image/pjpeg" = [image_viewer];
          "image/jpg" = [image_viewer];
          "image/jpeg" = [image_viewer];
          "image/gif" = [image_viewer];
          "image/bmp" = [image_viewer];
          "application/xhtml+xml" = [browser];
          "application/x-extension-xhtml" = [browser];
          "application/x-extension-xht" = [browser];
          "application/x-extension-shtml" = [browser];
          "application/x-extension-ics" = [mail];
          "application/x-extension-html" = [browser];
          "application/x-extension-htm" = [browser];
          "application/vnd.sqlite3" = [qgis];
          "application/vnd.oasis.opendocument.presentation" = [mail];
          "application/pdf" = [evince];
          "application/octet-stream" = [qgis];
          "application/x-ipynb+json" = [vscode]; # Jupyter Notebook MIME type
        };
      };
    };
  };
}
